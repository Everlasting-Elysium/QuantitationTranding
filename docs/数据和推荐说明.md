# æ•°æ®å’Œæ¨èè¯´æ˜ / Data and Recommendation Documentation

## é—®é¢˜è¯´æ˜ / Problem Description

### ä½ é‡åˆ°çš„é—®é¢˜
1. **æ¨èè‚¡ç¥¨å›ºå®š** - æ¯æ¬¡éƒ½æ¨èç›¸åŒçš„5åªè‚¡ç¥¨
2. **æ•°æ®æ¥æºç–‘é—®** - ä¸ç¡®å®šæ•°æ®æ˜¯å¦æ˜¯çº¿ä¸Šå®æ—¶æ•°æ®

## æ ¹æœ¬åŸå›  / Root Causes

### 1. ç¡¬ç¼–ç çš„æ¨¡æ‹Ÿæ¨è âŒ

**ä½ç½®**: `src/cli/guided_workflow.py` ç¬¬305-311è¡Œ

**ä»£ç **:
```python
# Mock recommendations (in real implementation, call PerformanceAnalyzer)
# æ¨¡æ‹Ÿæ¨èï¼ˆå®é™…å®ç°ä¸­è°ƒç”¨PerformanceAnalyzerï¼‰
mock_recommendations = [
    {"symbol": "600519", "name": "è´µå·èŒ…å°", "annual_return": 25.0, ...},
    {"symbol": "300750", "name": "å®å¾·æ—¶ä»£", "annual_return": 35.0, ...},
    {"symbol": "002594", "name": "æ¯”äºšè¿ª", "annual_return": 40.0, ...},
    {"symbol": "000858", "name": "äº”ç²®æ¶²", "annual_return": 22.0, ...},
    {"symbol": "601318", "name": "ä¸­å›½å¹³å®‰", "annual_return": 18.0, ...},
]
```

**é—®é¢˜**: 
- è¿™æ˜¯ç¡¬ç¼–ç çš„æ¨¡æ‹Ÿæ•°æ®
- ä¸æ˜¯åŸºäºçœŸå®å†å²æ•°æ®åˆ†æ
- æ¯æ¬¡è¿è¡Œéƒ½è¿”å›ç›¸åŒçš„5åªè‚¡ç¥¨
- æ”¶ç›Šç‡ç­‰æŒ‡æ ‡ä¹Ÿæ˜¯å›ºå®šçš„

### 2. å†å²æ•°æ®ï¼ˆéå®æ—¶ï¼‰ ğŸ“…

**æ•°æ®ä½ç½®**: `~/.qlib/qlib_data/cn_data/`

**æ•°æ®ä¿¡æ¯**:
```bash
æ•°æ®æ–‡ä»¶: qlib_data_cn_1d_0.6.1.zip
åˆ›å»ºæ—¶é—´: 2020å¹´9æœˆ-10æœˆ
æ•°æ®èŒƒå›´: 1999-11-10 åˆ° 2020-09-25
è‚¡ç¥¨æ•°é‡: 3874åª
æ•°æ®ç±»å‹: å†å²æ•°æ®ï¼ˆéå®æ—¶ï¼‰
```

**ç‰¹ç‚¹**:
- âœ… æ•°æ®å®Œæ•´ï¼ŒåŒ…å«3874åªè‚¡ç¥¨
- âœ… æ—¶é—´è·¨åº¦é•¿ï¼ˆ20å¹´+ï¼‰
- âŒ æ•°æ®æˆªæ­¢åˆ°2020å¹´9æœˆ
- âŒ ä¸åŒ…å«2020å¹´9æœˆä¹‹åçš„æ•°æ®
- âŒ ä¸æ˜¯å®æ—¶æ•°æ®

## è§£å†³æ–¹æ¡ˆ / Solutions

### æ–¹æ¡ˆ1: ä½¿ç”¨çœŸå®çš„æ€§èƒ½åˆ†æå™¨ï¼ˆæ¨èï¼‰âœ…

ç³»ç»Ÿå·²ç»å®ç°äº† `PerformanceAnalyzer` ç±»ï¼Œå¯ä»¥åŸºäºçœŸå®å†å²æ•°æ®è¿›è¡Œåˆ†æå’Œæ¨èã€‚

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**: `src/cli/guided_workflow.py`

**ä¿®æ”¹æ­¥éª¤**:

1. å¯¼å…¥æ€§èƒ½åˆ†æå™¨
2. æ›¿æ¢ç¡¬ç¼–ç çš„æ¨è
3. ä½¿ç”¨çœŸå®æ•°æ®åˆ†æ

**ä¿®æ”¹ç¤ºä¾‹**:
```python
# åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ å¯¼å…¥
from ..application.performance_analyzer import PerformanceAnalyzer
from ..infrastructure.qlib_wrapper import QlibWrapper

# åœ¨ _step_asset_recommendation æ–¹æ³•ä¸­
def _step_asset_recommendation(self) -> None:
    # åˆå§‹åŒ–åˆ†æå™¨
    qlib_wrapper = QlibWrapper()
    qlib_wrapper.init(
        provider_uri=str(Path.home() / ".qlib" / "qlib_data" / "cn_data"),
        region="cn"
    )
    analyzer = PerformanceAnalyzer(qlib_wrapper)
    
    # ä½¿ç”¨çœŸå®æ•°æ®åˆ†æ
    try:
        report = analyzer.analyze_historical_performance(
            market=self.state.market or "CN",
            asset_type=self.state.asset_type or "stock",
            lookback_years=3,
            instruments="csi300"  # æˆ–å…¶ä»–è‚¡ç¥¨æ± 
        )
        
        # è·å–æ¨è
        recommendations = []
        for asset in report.top_performers[:10]:
            recommendations.append({
                "symbol": asset.symbol,
                "name": asset.name or asset.symbol,
                "annual_return": asset.annual_return * 100,  # è½¬æ¢ä¸ºç™¾åˆ†æ¯”
                "sharpe_ratio": asset.sharpe_ratio,
                "max_drawdown": asset.max_drawdown * 100
            })
        
        self.state.recommended_assets = recommendations
        
    except Exception as e:
        # å¦‚æœåˆ†æå¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºåå¤‡
        self.prompt.display_message(
            f"âš ï¸  æ— æ³•åˆ†æçœŸå®æ•°æ®ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ¨è: {str(e)}",
            "warning"
        )
        # ä½¿ç”¨åŸæ¥çš„ mock_recommendations
```

### æ–¹æ¡ˆ2: æ›´æ–°åˆ°æœ€æ–°æ•°æ® ğŸ“Š

**é—®é¢˜**: å½“å‰æ•°æ®åªåˆ°2020å¹´9æœˆ

**è§£å†³æ–¹æ¡ˆ**: ä¸‹è½½æœ€æ–°çš„qlibæ•°æ®

#### é€‰é¡¹A: ä½¿ç”¨qlibå®˜æ–¹æ•°æ®

```bash
# ä¸‹è½½æœ€æ–°çš„ä¸­å›½Aè‚¡æ•°æ®
python -m qlib.run.get_data qlib_data --target_dir ~/.qlib/qlib_data/cn_data --region cn

# æˆ–è€…ä½¿ç”¨è„šæœ¬
python scripts/get_data.py qlib_data --target_dir ~/.qlib/qlib_data/cn_data --region cn
```

#### é€‰é¡¹B: ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®æº

å¦‚æœéœ€è¦å®æ—¶æ•°æ®ï¼Œå¯ä»¥ï¼š
1. æ¥å…¥å®æ—¶æ•°æ®APIï¼ˆå¦‚Tushareã€AKShareç­‰ï¼‰
2. å®šæœŸæ›´æ–°qlibæ•°æ®
3. å®ç°è‡ªå®šä¹‰æ•°æ®æä¾›è€…

**ç¤ºä¾‹ - ä½¿ç”¨Tushareæ›´æ–°æ•°æ®**:
```python
import tushare as ts
import qlib

# è®¾ç½®Tushare token
ts.set_token('your_token_here')
pro = ts.pro_api()

# è·å–æœ€æ–°æ•°æ®
df = pro.daily(trade_date='20241208')

# è½¬æ¢ä¸ºqlibæ ¼å¼å¹¶ä¿å­˜
# ... (éœ€è¦å®ç°æ•°æ®æ ¼å¼è½¬æ¢)
```

### æ–¹æ¡ˆ3: æ··åˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰ğŸ¯

ç»“åˆæ–¹æ¡ˆ1å’Œæ–¹æ¡ˆ2ï¼š

1. **çŸ­æœŸ**: ä½¿ç”¨ç°æœ‰å†å²æ•°æ® + çœŸå®æ€§èƒ½åˆ†æå™¨
   - ç«‹å³è§£å†³æ¨èå›ºå®šçš„é—®é¢˜
   - åŸºäºçœŸå®å†å²æ•°æ®åˆ†æ
   - æ¨èä¼šæ ¹æ®ä¸åŒçš„è‚¡ç¥¨æ± å’Œå‚æ•°å˜åŒ–

2. **ä¸­æœŸ**: æ›´æ–°æ•°æ®åˆ°æœ€æ–°
   - ä¸‹è½½æ›´æ–°çš„qlibæ•°æ®
   - æˆ–æ¥å…¥å®æ—¶æ•°æ®æº

3. **é•¿æœŸ**: å®ç°å®æ—¶æ•°æ®æ¥å…¥
   - é›†æˆå®æ—¶æ•°æ®API
   - è‡ªåŠ¨å®šæœŸæ›´æ–°æ•°æ®
   - æ”¯æŒç›˜ä¸­å®æ—¶åˆ†æ

## æ•°æ®è¯´æ˜ / Data Information

### å½“å‰æ•°æ®ç‰¹å¾

**ä¼˜ç‚¹** âœ…:
- æ•°æ®è´¨é‡é«˜ï¼ˆqlibå®˜æ–¹æ•°æ®ï¼‰
- æ—¶é—´è·¨åº¦é•¿ï¼ˆ20å¹´+å†å²ï¼‰
- è‚¡ç¥¨è¦†ç›–å…¨ï¼ˆ3874åªï¼‰
- é€‚åˆå›æµ‹å’Œç ”ç©¶

**é™åˆ¶** âŒ:
- æ•°æ®æˆªæ­¢åˆ°2020å¹´9æœˆ
- ä¸åŒ…å«æœ€è¿‘4å¹´çš„æ•°æ®
- ä¸æ˜¯å®æ—¶æ•°æ®
- æ— æ³•åæ˜ æœ€æ–°å¸‚åœºæƒ…å†µ

### æ•°æ®ç»“æ„

```
~/.qlib/qlib_data/cn_data/
â”œâ”€â”€ calendars/          # äº¤æ˜“æ—¥å†
â”œâ”€â”€ features/           # ç‰¹å¾æ•°æ®ï¼ˆ3874ä¸ªè‚¡ç¥¨ç›®å½•ï¼‰
â”‚   â”œâ”€â”€ SH600000/      # æµ¦å‘é“¶è¡Œ
â”‚   â”œâ”€â”€ SH600519/      # è´µå·èŒ…å°
â”‚   â””â”€â”€ ...
â””â”€â”€ instruments/        # è‚¡ç¥¨æ± å®šä¹‰
    â”œâ”€â”€ csi300.txt     # æ²ªæ·±300æˆåˆ†è‚¡
    â”œâ”€â”€ csi500.txt     # ä¸­è¯500æˆåˆ†è‚¡
    â””â”€â”€ all.txt        # å…¨éƒ¨è‚¡ç¥¨
```

### å¯ç”¨çš„è‚¡ç¥¨æ± 

1. **csi300** - æ²ªæ·±300ï¼ˆ300åªå¤§ç›˜è‚¡ï¼‰
2. **csi500** - ä¸­è¯500ï¼ˆ500åªä¸­ç›˜è‚¡ï¼‰
3. **all** - å…¨éƒ¨Aè‚¡ï¼ˆ3874åªï¼‰

## å®æ–½å»ºè®® / Implementation Recommendations

### ç«‹å³å®æ–½ï¼ˆä»Šå¤©ï¼‰

1. **ä¿®å¤ç¡¬ç¼–ç æ¨è**
   ```bash
   # ä¿®æ”¹ src/cli/guided_workflow.py
   # ä½¿ç”¨ PerformanceAnalyzer æ›¿æ¢ mock_recommendations
   ```

2. **æµ‹è¯•çœŸå®æ•°æ®åˆ†æ**
   ```bash
   # è¿è¡Œç³»ç»Ÿå¹¶æµ‹è¯•æ¨èåŠŸèƒ½
   python main.py
   ```

### çŸ­æœŸå®æ–½ï¼ˆæœ¬å‘¨ï¼‰

1. **å°è¯•æ›´æ–°æ•°æ®**
   ```bash
   # ä¸‹è½½æœ€æ–°qlibæ•°æ®
   python -m qlib.run.get_data qlib_data --target_dir ~/.qlib/qlib_data/cn_data --region cn
   ```

2. **éªŒè¯æ•°æ®æ›´æ–°**
   ```bash
   # æ£€æŸ¥æ•°æ®æ—¶é—´èŒƒå›´
   python -c "from src.infrastructure.qlib_wrapper import QlibWrapper; \
              w = QlibWrapper(); \
              w.init('~/.qlib/qlib_data/cn_data', 'cn'); \
              print(w.get_data_info())"
   ```

### ä¸­æœŸå®æ–½ï¼ˆæœ¬æœˆï¼‰

1. **æ¥å…¥å®æ—¶æ•°æ®æº**
   - æ³¨å†ŒTushareæˆ–AKShareè´¦å·
   - å®ç°æ•°æ®æ›´æ–°è„šæœ¬
   - è®¾ç½®å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ›´æ–°

2. **ä¼˜åŒ–æ¨èç®—æ³•**
   - æ·»åŠ æ›´å¤šè¯„ä¼°æŒ‡æ ‡
   - å®ç°å¤šå› å­é€‰è‚¡
   - æ”¯æŒè‡ªå®šä¹‰ç­›é€‰æ¡ä»¶

## ä»£ç ç¤ºä¾‹ / Code Examples

### ç¤ºä¾‹1: ä½¿ç”¨çœŸå®æ•°æ®åˆ†æ

```python
from src.application.performance_analyzer import PerformanceAnalyzer
from src.infrastructure.qlib_wrapper import QlibWrapper
from pathlib import Path

# åˆå§‹åŒ–
qlib_wrapper = QlibWrapper()
qlib_wrapper.init(
    provider_uri=str(Path.home() / ".qlib" / "qlib_data" / "cn_data"),
    region="cn"
)

analyzer = PerformanceAnalyzer(qlib_wrapper)

# åˆ†ææ²ªæ·±300æœ€è¿‘3å¹´è¡¨ç°
report = analyzer.analyze_historical_performance(
    market="CN",
    asset_type="stock",
    lookback_years=3,
    instruments="csi300"
)

# æŸ¥çœ‹æ¨è
print(f"åˆ†æäº† {report.total_assets_analyzed} åªè‚¡ç¥¨")
print(f"\nå‰10åæ¨è:")
for i, asset in enumerate(report.top_performers[:10], 1):
    print(f"{i}. {asset.symbol}: å¹´åŒ–æ”¶ç›Š {asset.annual_return*100:.2f}%")
```

### ç¤ºä¾‹2: æ£€æŸ¥æ•°æ®èŒƒå›´

```python
from src.infrastructure.qlib_wrapper import QlibWrapper
from pathlib import Path

qlib_wrapper = QlibWrapper()
qlib_wrapper.init(
    provider_uri=str(Path.home() / ".qlib" / "qlib_data" / "cn_data"),
    region="cn"
)

info = qlib_wrapper.get_data_info()
print(f"æ•°æ®èŒƒå›´: {info['data_start']} åˆ° {info['data_end']}")
print(f"äº¤æ˜“æ—¥æ•°: {info['trading_days']}")
```

## å¸¸è§é—®é¢˜ / FAQ

### Q1: ä¸ºä»€ä¹ˆæ¨èçš„è‚¡ç¥¨æ˜¯å›ºå®šçš„ï¼Ÿ
A: å› ä¸ºä½¿ç”¨äº†ç¡¬ç¼–ç çš„æ¨¡æ‹Ÿæ•°æ®ã€‚éœ€è¦ä¿®æ”¹ä»£ç ä½¿ç”¨çœŸå®çš„æ€§èƒ½åˆ†æå™¨ã€‚

### Q2: æ•°æ®æ˜¯å®æ—¶çš„å—ï¼Ÿ
A: ä¸æ˜¯ã€‚å½“å‰æ•°æ®æˆªæ­¢åˆ°2020å¹´9æœˆï¼Œæ˜¯å†å²æ•°æ®ã€‚

### Q3: å¦‚ä½•è·å–æœ€æ–°æ•°æ®ï¼Ÿ
A: 
1. ä½¿ç”¨qlibå®˜æ–¹æ•°æ®æ›´æ–°å‘½ä»¤
2. æˆ–æ¥å…¥å®æ—¶æ•°æ®APIï¼ˆTushareã€AKShareç­‰ï¼‰

### Q4: ä¿®æ”¹åæ¨èä¼šå˜åŒ–å—ï¼Ÿ
A: ä¼šçš„ã€‚ä½¿ç”¨çœŸå®æ•°æ®åˆ†æåï¼š
- æ¨èä¼šåŸºäºå®é™…å†å²è¡¨ç°
- ä¸åŒçš„è‚¡ç¥¨æ± ä¼šæœ‰ä¸åŒæ¨è
- ä¸åŒçš„æ—¶é—´èŒƒå›´ä¼šæœ‰ä¸åŒç»“æœ

### Q5: å†å²æ•°æ®èƒ½ç”¨äºå®ç›˜äº¤æ˜“å—ï¼Ÿ
A: ä¸å»ºè®®ã€‚å†å²æ•°æ®é€‚åˆï¼š
- ç­–ç•¥å›æµ‹
- æ¨¡å‹è®­ç»ƒ
- ç®—æ³•ç ”ç©¶

å®ç›˜äº¤æ˜“éœ€è¦å®æ—¶æˆ–è¿‘å®æ—¶æ•°æ®ã€‚

### Q6: å¦‚ä½•éªŒè¯æ•°æ®æ˜¯å¦æ›´æ–°ï¼Ÿ
A: è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ•°æ®æ—¶é—´èŒƒå›´ï¼š
```bash
python -c "from src.infrastructure.qlib_wrapper import QlibWrapper; \
           w = QlibWrapper(); \
           w.init('~/.qlib/qlib_data/cn_data', 'cn'); \
           print(w.get_data_info())"
```

## ç›¸å…³æ–‡ä»¶ / Related Files

- `src/cli/guided_workflow.py` - å¼•å¯¼å¼å·¥ä½œæµç¨‹ï¼ˆéœ€è¦ä¿®æ”¹ï¼‰
- `src/application/performance_analyzer.py` - æ€§èƒ½åˆ†æå™¨ï¼ˆå·²å®ç°ï¼‰
- `src/infrastructure/qlib_wrapper.py` - qlibå°è£…å™¨
- `config/model_templates.yaml` - æ¨¡å‹é…ç½®
- `~/.qlib/qlib_data/cn_data/` - æ•°æ®ç›®å½•

## æ€»ç»“ / Summary

**å½“å‰çŠ¶æ€**:
- âŒ ä½¿ç”¨ç¡¬ç¼–ç çš„æ¨¡æ‹Ÿæ¨è
- âŒ æ•°æ®æˆªæ­¢åˆ°2020å¹´9æœˆ
- âœ… æœ‰å®Œæ•´çš„æ€§èƒ½åˆ†æå™¨å®ç°
- âœ… æœ‰3874åªè‚¡ç¥¨çš„å†å²æ•°æ®

**éœ€è¦åšçš„**:
1. ä¿®æ”¹ä»£ç ä½¿ç”¨çœŸå®æ€§èƒ½åˆ†æå™¨
2. è€ƒè™‘æ›´æ–°æ•°æ®åˆ°æœ€æ–°
3. é•¿æœŸè€ƒè™‘æ¥å…¥å®æ—¶æ•°æ®

**é¢„æœŸæ•ˆæœ**:
- âœ… æ¨èä¼šåŸºäºçœŸå®æ•°æ®
- âœ… æ¨èä¼šæ ¹æ®å‚æ•°å˜åŒ–
- âœ… æ›´æ¥è¿‘å®é™…æŠ•èµ„åœºæ™¯

---

**å»ºè®®**: å…ˆä¿®æ”¹ä»£ç ä½¿ç”¨çœŸå®åˆ†æå™¨ï¼Œç„¶åå†è€ƒè™‘æ•°æ®æ›´æ–°ã€‚
