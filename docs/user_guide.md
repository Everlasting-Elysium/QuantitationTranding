# 用户手册 (User Guide)

本手册详细介绍量化交易系统的所有功能和使用方法。

## 📑 目录

1. [系统概述](#系统概述)
2. [功能模块](#功能模块)
3. [模型训练](#模型训练)
4. [回测分析](#回测分析)
5. [交易信号](#交易信号)
6. [模型管理](#模型管理)
7. [数据管理](#数据管理)
8. [配置管理](#配置管理)
9. [高级功能](#高级功能)
10. [最佳实践](#最佳实践)

## 系统概述

量化交易系统是一个基于qlib的智能交易平台，提供从数据处理、模型训练、回测分析到交易信号生成的完整工作流。

### 核心特性

- **用户友好**: 交互式界面，无需编程
- **功能完整**: 涵盖量化交易全流程
- **性能优秀**: 基于qlib高性能框架
- **可扩展**: 支持自定义模型和策略
- **中文支持**: 全中文界面和文档

### 系统架构

系统采用分层架构设计：

```
CLI层 → 应用层 → 核心层 → 基础设施层
```

- **CLI层**: 用户交互界面
- **应用层**: 业务逻辑实现
- **核心层**: 核心功能服务
- **基础设施层**: 第三方框架封装

## 功能模块

### 主菜单

启动系统后，你会看到主菜单：

```
=== 主菜单 ===
1. 训练模型
2. 运行回测
3. 生成交易信号
4. 管理模型
5. 数据管理
6. 查看帮助
7. 退出
```

每个功能模块都有详细的子菜单和引导。


## 模型训练

模型训练是量化交易的核心环节。系统提供两种训练方式：

### 使用模板训练（推荐新手）

模板训练使用预配置的模型参数，适合快速开始。

#### 步骤1: 选择模板

系统提供三种模型模板：

**1. LGBM模型**
- **模型类型**: LightGBM梯度提升树
- **适用场景**: 中短期股票预测（1-20天）
- **优点**: 训练速度快，效果稳定，资源占用少
- **缺点**: 对长期趋势捕捉能力有限
- **推荐指数**: ⭐⭐⭐⭐⭐
- **预期年化收益**: 15-25%
- **训练时间**: 3-10分钟

**2. Linear模型**
- **模型类型**: 线性回归模型
- **适用场景**: 因子分析和特征研究
- **优点**: 可解释性强，训练极快
- **缺点**: 无法捕捉非线性关系
- **推荐指数**: ⭐⭐⭐
- **预期年化收益**: 10-15%
- **训练时间**: 1-3分钟

**3. MLP神经网络**
- **模型类型**: 多层感知机
- **适用场景**: 复杂模式识别
- **优点**: 能捕捉复杂的非线性关系
- **缺点**: 训练时间长，需要更多数据
- **推荐指数**: ⭐⭐⭐⭐
- **预期年化收益**: 20-30%
- **训练时间**: 10-30分钟

#### 步骤2: 确认训练参数

选择模板后，系统会显示默认参数：

```
=== 训练参数 ===
数据集: 沪深300成分股
训练期间: 2020-01-01 至 2022-12-31
验证期间: 2023-01-01 至 2023-12-31
特征数量: 158个技术指标
模型参数: 使用模板默认值

是否使用这些参数？(y/n): 
```

输入 `y` 确认，或 `n` 自定义参数。

#### 步骤3: 监控训练过程

训练开始后，系统会实时显示进度：

```
[1/4] 加载数据...
✓ 加载了 300 只股票的数据
✓ 时间范围: 2020-01-01 至 2023-12-31
✓ 数据点: 1,234,567 条

[2/4] 特征工程...
✓ 生成了 158 个特征
✓ 处理缺失值: 前向填充
✓ 标准化处理完成

[3/4] 训练模型...
Epoch 1/100: loss=0.234, ic=0.045
Epoch 25/100: loss=0.178, ic=0.067
Epoch 50/100: loss=0.156, ic=0.078
Epoch 75/100: loss=0.148, ic=0.082
Epoch 100/100: loss=0.142, ic=0.085
✓ 模型训练完成

[4/4] 评估模型...
训练集指标:
  - IC: 0.085
  - ICIR: 1.23
  - Rank IC: 0.092
  - 准确率: 68.5%

验证集指标:
  - IC: 0.078
  - ICIR: 1.15
  - Rank IC: 0.085
  - 准确率: 65.2%

✓ 模型评估完成
```

#### 步骤4: 查看训练结果

训练完成后，系统会生成详细报告：

```
🎉 训练成功！

模型信息:
- 模型ID: lgbm_20240101_123456
- 模型类型: LightGBM
- 训练时间: 2024-01-01 12:34:56
- 训练耗时: 3分25秒

性能指标:
- 验证集IC: 0.078 (良好)
- 验证集准确率: 65.2% (良好)
- 过拟合程度: 低

模型已保存到: model_registry/lgbm_20240101_123456/
详细报告: outputs/training_report_20240101_123456.html

下一步建议:
1. 运行回测验证模型表现
2. 生成交易信号查看预测结果
3. 如果效果不理想，尝试调整参数
```

### 自定义训练

自定义训练允许你完全控制训练参数。

#### 可配置参数

**数据集配置**:
- **股票池**: 沪深300、中证500、全市场等
- **时间范围**: 训练集和验证集的起止日期
- **数据频率**: 日线、周线、月线

**特征配置**:
- **技术指标**: 选择要使用的技术指标
- **基本面因子**: 选择基本面数据
- **自定义特征**: 添加自定义计算的特征

**模型配置**:
- **模型类型**: LGBM、Linear、MLP等
- **超参数**: 学习率、树深度、隐藏层等
- **训练参数**: 迭代次数、批次大小等

**实验配置**:
- **实验名称**: 用于MLflow追踪
- **标签**: 为实验添加标签
- **备注**: 记录实验目的和想法

#### 参数调优建议

**LGBM模型**:
```yaml
learning_rate: 0.05-0.1  # 学习率，越小越稳定但训练越慢
num_leaves: 31-127       # 叶子节点数，越大模型越复杂
max_depth: 5-10          # 树深度，控制过拟合
n_estimators: 100-500    # 树的数量
```

**MLP模型**:
```yaml
hidden_size: 64-256      # 隐藏层大小
num_layers: 2-4          # 隐藏层数量
dropout: 0.1-0.3         # Dropout比例，防止过拟合
learning_rate: 0.001-0.01 # 学习率
```


## 回测分析

回测是验证模型效果的重要环节，通过历史数据模拟交易来评估策略表现。

### 运行回测

#### 步骤1: 选择模型

```
=== 回测分析 ===
请选择要回测的模型:

最近训练的模型:
1. lgbm_20240101_123456 (2024-01-01, IC: 0.078)
2. mlp_20231225_234567 (2023-12-25, IC: 0.082)
3. linear_20231220_345678 (2023-12-20, IC: 0.065)

4. 输入其他模型ID
5. 查看所有模型

请选择 (1-5): 
```

#### 步骤2: 设置回测参数

```
=== 回测参数设置 ===

回测时间范围:
- 开始日期 [2023-01-01]: 
- 结束日期 [2023-12-31]: 

初始资金:
- 金额 [1,000,000]: 

交易策略:
1. TopK策略 - 买入预测得分最高的K只股票
2. 权重策略 - 根据预测得分分配权重
3. 自定义策略

请选择策略 (1-3): 1

TopK策略参数:
- K值（持仓股票数量）[30]: 
- 调仓频率（天）[5]: 

风险控制:
- 单只股票最大仓位 [10%]: 
- 止损线 [-5%]: 

基准指数:
1. 沪深300
2. 中证500
3. 上证指数
4. 不使用基准

请选择 (1-4): 1
```

#### 步骤3: 查看回测结果

回测完成后，系统会显示详细结果：

```
=== 回测结果 ===

回测期间: 2023-01-01 至 2023-12-31
初始资金: 1,000,000 元
最终资金: 1,285,000 元

【收益指标】
总收益率: 28.5%
年化收益率: 28.5%
基准收益率: 12.3% (沪深300)
超额收益: 16.2%
月均收益: 2.1%

【风险指标】
夏普比率: 1.65 (优秀)
最大回撤: -12.8%
波动率: 18.2%
卡玛比率: 2.23
索提诺比率: 2.15

【交易统计】
总交易次数: 1,234
买入次数: 617
卖出次数: 617
平均持仓天数: 8.5天
换手率: 245%

【胜率分析】
总胜率: 62.5%
盈利交易: 771次
亏损交易: 463次
盈亏比: 1.8
最大单笔盈利: 8.5%
最大单笔亏损: -5.2%

【月度收益】
2023-01: +3.2%
2023-02: +1.8%
2023-03: +4.5%
2023-04: -2.1%
2023-05: +2.8%
2023-06: +1.5%
2023-07: +3.8%
2023-08: -1.2%
2023-09: +2.5%
2023-10: +4.2%
2023-11: +3.1%
2023-12: +2.4%

详细报告已保存: outputs/backtest_report_20240101_123456.html
```

### 理解回测指标

#### 收益指标

**总收益率**
- 定义: (最终资金 - 初始资金) / 初始资金
- 解读: 整个回测期间的总收益
- 好坏标准: 
  - 优秀: >30%
  - 良好: 20-30%
  - 一般: 10-20%
  - 较差: <10%

**年化收益率**
- 定义: 将收益率换算成年化数值
- 解读: 便于不同时间长度的策略对比
- 好坏标准:
  - 优秀: >25%
  - 良好: 15-25%
  - 一般: 8-15%
  - 较差: <8%

**超额收益**
- 定义: 策略收益率 - 基准收益率
- 解读: 相对于市场的超额表现
- 好坏标准:
  - 优秀: >15%
  - 良好: 8-15%
  - 一般: 3-8%
  - 较差: <3%

#### 风险指标

**夏普比率 (Sharpe Ratio)**
- 定义: (年化收益率 - 无风险利率) / 年化波动率
- 解读: 每承担一单位风险获得的超额收益
- 好坏标准:
  - 优秀: >1.5
  - 良好: 1.0-1.5
  - 一般: 0.5-1.0
  - 较差: <0.5

**最大回撤 (Max Drawdown)**
- 定义: 从最高点到最低点的最大跌幅
- 解读: 衡量策略的最大风险
- 好坏标准:
  - 优秀: <10%
  - 良好: 10-15%
  - 一般: 15-25%
  - 较差: >25%

**波动率 (Volatility)**
- 定义: 收益率的标准差
- 解读: 收益的稳定性
- 好坏标准:
  - 优秀: <15%
  - 良好: 15-20%
  - 一般: 20-30%
  - 较差: >30%

#### 交易指标

**胜率 (Win Rate)**
- 定义: 盈利交易次数 / 总交易次数
- 解读: 交易成功的概率
- 好坏标准:
  - 优秀: >60%
  - 良好: 55-60%
  - 一般: 50-55%
  - 较差: <50%

**盈亏比 (Profit/Loss Ratio)**
- 定义: 平均盈利 / 平均亏损
- 解读: 盈利交易和亏损交易的比例
- 好坏标准:
  - 优秀: >2.0
  - 良好: 1.5-2.0
  - 一般: 1.0-1.5
  - 较差: <1.0

**换手率 (Turnover)**
- 定义: 交易金额 / 平均持仓金额
- 解读: 交易的频繁程度
- 注意: 过高的换手率会增加交易成本

### 回测报告

系统会生成HTML格式的详细报告，包含：

**1. 收益曲线图**
- 策略累计收益曲线
- 基准累计收益曲线
- 超额收益曲线

**2. 回撤曲线图**
- 策略回撤曲线
- 最大回撤标注

**3. 持仓分布图**
- 各股票持仓比例
- 行业分布
- 市值分布

**4. 交易明细表**
- 每笔交易的详细信息
- 买入/卖出时间、价格、数量
- 盈亏情况

**5. 月度收益表**
- 每月收益率
- 月度胜率
- 月度最大回撤


## 交易信号

交易信号功能根据模型预测生成具体的买卖建议。

### 生成信号

#### 步骤1: 选择模型和日期

```
=== 交易信号生成 ===

请选择模型:
1. lgbm_20240101_123456 (推荐)
2. mlp_20231225_234567
3. 输入其他模型ID

请选择 (1-3): 1

请选择日期:
1. 今天 (2024-01-01)
2. 指定日期

请选择 (1-2): 1
```

#### 步骤2: 设置信号参数

```
=== 信号参数 ===

当前持仓:
1. 导入持仓文件
2. 手动输入持仓
3. 空仓（首次交易）

请选择 (1-3): 3

风险控制:
- 单只股票最大仓位 [10%]: 
- 最大持仓数量 [30]: 
- 最小置信度 [0.6]: 

是否需要信号解释？(y/n): y
```

#### 步骤3: 查看信号结果

```
=== 今日交易建议 (2024-01-01) ===

【强烈买入】⭐⭐⭐⭐⭐

1. 贵州茅台 (600519)
   预测得分: 0.85
   置信度: 92% (高)
   建议仓位: 5%
   当前价格: 1,800元
   建议买入: 27股
   
   📊 信号解释:
   - 技术面: 强势突破，MACD金叉
   - 基本面: 业绩稳健，ROE持续提升
   - 市场面: 资金流入，成交量放大
   - 风险提示: 估值偏高，注意回调风险

2. 宁德时代 (300750)
   预测得分: 0.78
   置信度: 85% (高)
   建议仓位: 4%
   当前价格: 180元
   建议买入: 222股
   
   📊 信号解释:
   - 技术面: 均线多头排列
   - 基本面: 行业景气度高，订单饱满
   - 市场面: 机构持续增持
   - 风险提示: 短期涨幅较大，可能回调

【买入】⭐⭐⭐⭐

3. 比亚迪 (002594)
   预测得分: 0.72
   置信度: 78% (中高)
   建议仓位: 3%
   ...

【观望】⭐⭐⭐

10. 某某股票 (000010)
    预测得分: 0.55
    置信度: 62% (中)
    建议: 暂不操作
    原因: 信号不够强烈，等待更好时机

【卖出】⭐

15. 某某股票 (000015)
    预测得分: -0.65
    置信度: 88% (高)
    建议: 全部卖出
    当前持仓: 500股
    
    📊 信号解释:
    - 技术面: 跌破重要支撑位
    - 基本面: 业绩预警，盈利下滑
    - 市场面: 资金流出，成交萎缩
    - 风险提示: 可能继续下跌

【风险提示】⚠️
- 市场整体波动较大，建议控制总仓位在70%以内
- 注意设置止损，单只股票亏损超过5%建议止损
- 建议分批建仓，不要一次性买入

【组合建议】
- 建议持仓数量: 25-30只
- 建议行业分布: 
  * 消费: 30%
  * 科技: 25%
  * 医药: 20%
  * 金融: 15%
  * 其他: 10%

信号详情已保存: outputs/signals_20240101.csv
```

### 信号解释

系统提供详细的信号解释，帮助你理解为什么推荐买入或卖出。

#### 技术面分析

**趋势指标**:
- MA均线: 短期、中期、长期均线的排列
- MACD: 金叉、死叉信号
- KDJ: 超买、超卖信号

**动量指标**:
- RSI: 相对强弱指标
- CCI: 顺势指标
- 威廉指标: 超买超卖

**成交量指标**:
- 成交量变化
- 量价关系
- OBV能量潮

#### 基本面分析

**盈利能力**:
- ROE: 净资产收益率
- ROA: 总资产收益率
- 净利润增长率

**估值指标**:
- PE: 市盈率
- PB: 市净率
- PS: 市销率

**成长性**:
- 营收增长率
- 利润增长率
- 市场份额变化

#### 市场面分析

**资金流向**:
- 主力资金流入流出
- 机构持仓变化
- 北向资金动向

**市场情绪**:
- 换手率
- 振幅
- 涨跌家数比

### 信号置信度

系统为每个信号提供置信度评分：

- **90%以上**: 非常高，强烈建议
- **80-90%**: 高，建议操作
- **70-80%**: 中高，可以考虑
- **60-70%**: 中等，谨慎操作
- **60%以下**: 低，不建议操作

### 风险控制

系统内置多层风险控制：

**仓位控制**:
- 单只股票不超过10%
- 总仓位不超过90%
- 预留现金应对风险

**止损机制**:
- 单只股票亏损5%止损
- 总仓位亏损10%减仓
- 总仓位亏损15%清仓

**分散投资**:
- 持仓数量25-30只
- 行业分散配置
- 避免过度集中

## 模型管理

模型管理功能帮助你组织和追踪所有训练的模型。

### 查看模型列表

```
=== 模型管理 ===
1. 查看所有模型
2. 查看模型详情
3. 对比模型性能
4. 设置生产模型
5. 删除模型

请选择 (1-5): 1

=== 模型列表 ===

最近训练的模型:
┌────┬─────────────────────┬──────────┬────────┬──────────┬────────┐
│ ID │ 模型名称             │ 类型     │ IC     │ 训练日期  │ 状态   │
├────┼─────────────────────┼──────────┼────────┼──────────┼────────┤
│ 1  │ lgbm_20240101_123456│ LGBM     │ 0.078  │ 2024-01-01│ 生产中 │
│ 2  │ mlp_20231225_234567 │ MLP      │ 0.082  │ 2023-12-25│ 候选   │
│ 3  │ linear_20231220_345 │ Linear   │ 0.065  │ 2023-12-20│ 归档   │
│ 4  │ lgbm_20231215_456789│ LGBM     │ 0.072  │ 2023-12-15│ 归档   │
└────┴─────────────────────┴──────────┴────────┴──────────┴────────┘

按性能排序:
1. mlp_20231225_234567 (IC: 0.082)
2. lgbm_20240101_123456 (IC: 0.078)
3. lgbm_20231215_456789 (IC: 0.072)
4. linear_20231220_345 (IC: 0.065)
```

### 查看模型详情

```
请输入模型ID: lgbm_20240101_123456

=== 模型详情 ===

基本信息:
- 模型ID: lgbm_20240101_123456
- 模型名称: LGBM模型
- 模型类型: LightGBM
- 训练日期: 2024-01-01 12:34:56
- 训练耗时: 3分25秒
- 状态: 生产中

数据集信息:
- 股票池: 沪深300
- 训练期间: 2020-01-01 至 2022-12-31
- 验证期间: 2023-01-01 至 2023-12-31
- 样本数量: 1,234,567
- 特征数量: 158

性能指标:
- 训练集IC: 0.085
- 验证集IC: 0.078
- 训练集准确率: 68.5%
- 验证集准确率: 65.2%
- 过拟合程度: 低

模型参数:
- learning_rate: 0.05
- num_leaves: 63
- max_depth: 7
- n_estimators: 200
- min_child_samples: 20

使用记录:
- 回测次数: 5
- 信号生成次数: 12
- 最后使用: 2024-01-01

文件位置:
- 模型文件: model_registry/lgbm_20240101_123456/model.pkl
- 配置文件: model_registry/lgbm_20240101_123456/config.yaml
- 训练报告: outputs/training_report_20240101_123456.html
```

### 对比模型性能

```
=== 模型对比 ===

请选择要对比的模型（输入ID，用逗号分隔）:
> 1,2,3

对比结果:

┌──────────┬────────┬────────┬────────┬────────┬────────┐
│ 指标     │ 模型1  │ 模型2  │ 模型3  │ 最优   │ 推荐   │
├──────────┼────────┼────────┼────────┼────────┼────────┤
│ IC       │ 0.078  │ 0.082  │ 0.065  │ 模型2  │ ⭐     │
│ 准确率   │ 65.2%  │ 67.8%  │ 62.1%  │ 模型2  │ ⭐     │
│ 夏普比率 │ 1.65   │ 1.72   │ 1.45   │ 模型2  │ ⭐     │
│ 最大回撤 │ -12.8% │ -14.2% │ -11.5% │ 模型3  │        │
│ 年化收益 │ 28.5%  │ 31.2%  │ 22.8%  │ 模型2  │ ⭐     │
│ 训练时间 │ 3分钟  │ 25分钟 │ 1分钟  │ 模型3  │        │
└──────────┴────────┴────────┴────────┴────────┴────────┘

综合评分:
1. 模型2 (MLP): 92分 - 性能最优，但训练时间较长
2. 模型1 (LGBM): 88分 - 性能良好，训练快速
3. 模型3 (Linear): 75分 - 性能一般，但速度最快

推荐: 如果追求最优性能，选择模型2；如果需要快速迭代，选择模型1
```


## 数据管理

数据是量化交易的基础，系统提供完整的数据管理功能。

### 数据下载

```
=== 数据管理 ===
1. 下载数据
2. 更新数据
3. 验证数据
4. 查看数据信息
5. 清理数据

请选择 (1-5): 1

=== 数据下载 ===

请选择数据源:
1. 中国A股数据 (qlib官方)
2. 美股数据 (qlib官方)
3. 自定义数据源

请选择 (1-3): 1

请选择数据频率:
1. 日线数据 (推荐)
2. 周线数据
3. 月线数据

请选择 (1-3): 1

开始下载...
[████████████████████] 100%
✓ 下载完成

数据统计:
- 股票数量: 4,856只
- 时间范围: 2010-01-01 至 2024-01-01
- 数据大小: 2.3GB
- 保存位置: ~/.qlib/qlib_data/cn_data
```

### 数据更新

```
=== 数据更新 ===

当前数据信息:
- 最后更新: 2023-12-31
- 数据完整性: 98.5%
- 缺失天数: 3天

是否更新到最新？(y/n): y

正在更新...
[████████████████████] 100%
✓ 更新完成

更新统计:
- 新增数据: 2024-01-01 至 2024-01-05
- 新增股票: 12只
- 修正数据: 5条
```

### 数据验证

```
=== 数据验证 ===

验证项目:
[1/5] 检查数据完整性...
✓ 数据完整性: 99.2%
⚠️ 发现3只股票数据不完整

[2/5] 检查数据格式...
✓ 数据格式正确

[3/5] 检查缺失值...
✓ 缺失值比例: 0.8%
ℹ️ 缺失值已使用前向填充处理

[4/5] 检查异常值...
⚠️ 发现5条异常数据
ℹ️ 异常数据已标记，不影响使用

[5/5] 检查时间连续性...
✓ 时间序列连续

验证结果: 通过 ✓
数据可以正常使用
```

### 查看数据信息

```
=== 数据信息 ===

基本信息:
- 数据源: qlib官方中国A股数据
- 数据频率: 日线
- 时间范围: 2010-01-01 至 2024-01-05
- 股票数量: 4,868只
- 交易日数量: 3,456天

数据字段:
- open: 开盘价
- high: 最高价
- low: 最低价
- close: 收盘价
- volume: 成交量
- amount: 成交额
- factor: 复权因子

数据质量:
- 完整性: 99.2%
- 准确性: 99.8%
- 及时性: 最新 (T+1)

存储信息:
- 数据大小: 2.35GB
- 存储位置: ~/.qlib/qlib_data/cn_data
- 压缩格式: Parquet
```

## 配置管理

系统通过配置文件管理各种参数，支持灵活定制。

### 配置文件结构

系统使用YAML格式的配置文件，位于 `config/` 目录：

```
config/
├── default_config.yaml      # 主配置文件
├── model_templates.yaml     # 模型模板配置
├── markets.yaml            # 市场配置
├── risk_thresholds.yaml    # 风险阈值配置
└── notification_config.yaml # 通知配置
```

### 主配置文件

`config/default_config.yaml`:

```yaml
# 数据配置
data:
  provider_uri: "~/.qlib/qlib_data/cn_data"
  region: "cn"
  instruments: "csi300"  # 股票池
  start_time: "2020-01-01"
  end_time: "2023-12-31"

# 模型配置
model:
  default_type: "lgbm"
  save_dir: "model_registry"

# MLflow配置
mlflow:
  enabled: true
  tracking_uri: "file:./mlruns"
  experiment_name: "qlib_trading"

# 日志配置
logging:
  level: "INFO"
  log_dir: "logs"
  max_size: "100MB"
  backup_count: 5

# 回测配置
backtest:
  initial_capital: 1000000
  benchmark: "SH000300"  # 沪深300
  top_k: 30
  rebalance_freq: 5

# 风险控制
risk:
  max_position_size: 0.1  # 单只股票最大10%
  max_positions: 30
  stop_loss: -0.05  # 止损-5%
  max_drawdown: -0.15  # 最大回撤-15%
```

### 修改配置

你可以直接编辑配置文件，或通过系统界面修改：

```
=== 配置管理 ===
1. 查看当前配置
2. 修改配置
3. 重置为默认配置
4. 导入配置
5. 导出配置

请选择 (1-5): 2

=== 修改配置 ===

请选择要修改的配置项:
1. 数据配置
2. 模型配置
3. MLflow配置
4. 日志配置
5. 回测配置
6. 风险控制

请选择 (1-6): 6

=== 风险控制配置 ===

当前配置:
- 单只股票最大仓位: 10%
- 最大持仓数量: 30
- 止损线: -5%
- 最大回撤: -15%

请输入新值（直接回车保持不变）:
- 单只股票最大仓位 [10%]: 8%
- 最大持仓数量 [30]: 25
- 止损线 [-5%]: 
- 最大回撤 [-15%]: -12%

确认修改？(y/n): y
✓ 配置已更新
```

## 高级功能

### MLflow实验追踪

系统集成MLflow，自动记录所有训练实验。

#### 启动MLflow UI

```bash
# 在项目目录运行
mlflow ui
```

然后在浏览器打开 `http://localhost:5000`

#### MLflow功能

**实验管理**:
- 查看所有实验
- 对比不同实验
- 搜索和过滤

**指标追踪**:
- 训练曲线
- 评估指标
- 参数对比

**模型管理**:
- 模型版本控制
- 模型注册
- 模型部署

### 自定义特征

系统支持添加自定义特征：

```python
# 在 src/core/custom_features.py 中定义

def my_custom_feature(data):
    """
    自定义特征计算函数
    
    Args:
        data: 股票数据DataFrame
        
    Returns:
        计算后的特征值
    """
    # 示例：计算20日动量
    return data['close'].pct_change(20)

# 注册特征
register_feature('my_momentum_20', my_custom_feature)
```

### 自定义策略

系统支持自定义交易策略：

```python
# 在 src/application/custom_strategy.py 中定义

class MyStrategy(BaseStrategy):
    """自定义交易策略"""
    
    def generate_signals(self, predictions, portfolio):
        """
        根据预测生成交易信号
        
        Args:
            predictions: 模型预测结果
            portfolio: 当前持仓
            
        Returns:
            交易信号列表
        """
        signals = []
        
        # 你的策略逻辑
        for stock, score in predictions.items():
            if score > 0.7:
                signals.append({
                    'stock': stock,
                    'action': 'buy',
                    'weight': score
                })
        
        return signals
```

### 批量操作

系统支持批量训练和回测：

```bash
# 批量训练多个模型
python scripts/batch_train.py --config configs/batch_config.yaml

# 批量回测
python scripts/batch_backtest.py --models model1,model2,model3
```

## 最佳实践

### 模型训练最佳实践

**1. 数据准备**
- 确保数据完整性和准确性
- 使用足够长的历史数据（至少3年）
- 定期更新数据

**2. 特征选择**
- 从简单特征开始
- 逐步添加复杂特征
- 避免特征过多导致过拟合

**3. 模型选择**
- 新手从LGBM开始
- 对比多个模型
- 选择稳定性好的模型

**4. 参数调优**
- 使用网格搜索或贝叶斯优化
- 关注验证集表现
- 避免过度优化

**5. 防止过拟合**
- 使用交叉验证
- 监控训练集和验证集差异
- 适当使用正则化

### 回测最佳实践

**1. 回测设置**
- 使用足够长的回测期（至少1年）
- 包含不同市场环境（牛市、熊市、震荡市）
- 考虑交易成本

**2. 结果分析**
- 不只看收益率，更要看风险指标
- 分析回撤的原因
- 检查交易频率是否合理

**3. 避免陷阱**
- 警惕过度拟合历史数据
- 不要只在牛市回测
- 考虑滑点和冲击成本

### 实盘交易最佳实践

**1. 风险控制**
- 严格执行止损
- 控制仓位
- 分散投资

**2. 资金管理**
- 不要满仓操作
- 预留应急资金
- 根据市场调整仓位

**3. 心态管理**
- 相信系统，不要情绪化操作
- 接受亏损是正常的
- 长期坚持策略

**4. 持续优化**
- 定期回顾交易记录
- 分析失败案例
- 不断改进策略

### 常见错误

**1. 过度优化**
- 问题：在历史数据上过度调参
- 后果：实盘表现远不如回测
- 解决：使用样本外数据验证

**2. 忽视交易成本**
- 问题：回测时不考虑手续费和滑点
- 后果：实际收益大打折扣
- 解决：在回测中加入真实成本

**3. 频繁调整策略**
- 问题：看到短期亏损就改变策略
- 后果：无法评估策略真实效果
- 解决：给策略足够的时间验证

**4. 仓位过重**
- 问题：单只股票或总仓位过高
- 后果：风险过大，可能爆仓
- 解决：严格控制仓位比例

**5. 忽视风险**
- 问题：只关注收益，不关注风险
- 后果：遇到黑天鹅事件损失惨重
- 解决：建立完善的风险控制体系

## 故障排除

### 常见问题

**Q: 系统启动失败**
```
错误: ModuleNotFoundError: No module named 'qlib'
解决: pip install qlib
```

**Q: 数据下载失败**
```
错误: Connection timeout
解决: 
1. 检查网络连接
2. 使用代理
3. 手动下载数据
```

**Q: 训练时内存不足**
```
错误: MemoryError
解决:
1. 减少数据量
2. 使用更简单的模型
3. 增加系统内存
```

**Q: MLflow无法启动**
```
错误: Address already in use
解决: 
1. 关闭占用5000端口的程序
2. 使用其他端口: mlflow ui --port 5001
```

### 日志查看

系统日志位于 `logs/qlib_trading.log`：

```bash
# 查看最新日志
tail -f logs/qlib_trading.log

# 搜索错误
grep ERROR logs/qlib_trading.log

# 查看特定时间的日志
grep "2024-01-01" logs/qlib_trading.log
```

### 获取帮助

如果遇到问题：

1. 查看日志文件
2. 阅读文档
3. 搜索GitHub Issues
4. 提交新Issue
5. 加入社区讨论

## 附录

### 术语表

详细的术语解释请参考[快速开始指南](quick_start.md#术语解释)

### 快捷键

系统支持以下快捷键：

- `Ctrl+C`: 中断当前操作
- `Ctrl+D`: 退出系统
- `h`: 显示帮助
- `q`: 返回上级菜单

### 配置参考

完整的配置参数请参考[API参考文档](api_reference.md)

---

**祝你使用愉快！** 📈🚀
